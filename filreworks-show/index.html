<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>çƒŸèŠ±ç§€ - Fireworks Symphony</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --night-black: #0a0a0f;
      --deep-purple: #1a1a2e;
      --electric-blue: #16213e;
      --neon-cyan: #00f5ff;
      --bright-gold: #ffd700;
      --fire-red: #ff4757;
      --spark-white: #fff;
      --control-bg: rgb(26, 26, 46, 90%);
      --control-border: rgb(0, 245, 255, 30%);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: Rajdhani, sans-serif;
      background: linear-gradient(135deg, var(--night-black) 0%, var(--deep-purple) 50%, var(--electric-blue) 100%);
      min-height: 100vh;
      color: var(--spark-white);
      overflow: hidden;
      touch-action: manipulation;
    }

    .container {
      position: relative;
      width: 100vw;
      height: 100vh;
      display: flex;
    }

    /* Mobile Toggle Button */
    .mobile-toggle {
      display: none;
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 200;
      background: var(--control-bg);
      border: 1px solid var(--control-border);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      color: var(--neon-cyan);
      font-size: 20px;
      cursor: pointer;
      backdrop-filter: blur(15px);
      box-shadow: 0 4px 15px rgb(0, 0, 0, 30%);
      transition: all 0.3s ease;
      align-items: center;
      justify-content: center;
    }

    .mobile-toggle:hover {
      transform: scale(1.1);
      box-shadow: 0 0 20px rgb(0, 245, 255, 50%);
    }

    .mobile-toggle.active {
      background: var(--neon-cyan);
      color: var(--night-black);
    }

    /* Control Panel */
    .control-panel {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 320px;
      background: var(--control-bg);
      backdrop-filter: blur(15px);
      border: 1px solid var(--control-border);
      border-radius: 15px;
      padding: 20px;
      z-index: 100;
      box-shadow: 0 10px 30px rgb(0, 0, 0, 50%);
      transition: all 0.3s ease;
    }

    .control-panel:hover {
      box-shadow: 0 15px 40px rgb(0, 245, 255, 20%);
    }

    .panel-header {
      text-align: center;
      margin-bottom: 25px;
    }

    .panel-title {
      font-family: Orbitron, monospace;
      font-size: 24px;
      font-weight: 700;
      color: var(--neon-cyan);
      text-shadow: 0 0 10px var(--neon-cyan);
      margin-bottom: 5px;
    }

    .panel-subtitle {
      font-size: 14px;
      color: rgb(255, 255, 255, 70%);
      font-weight: 300;
    }

    /* Control Sections */
    .control-section {
      margin-bottom: 25px;
      padding: 15px;
      background: rgb(0, 0, 0, 30%);
      border-radius: 10px;
      border: 1px solid rgb(255, 255, 255, 10%);
    }

    .section-title {
      font-family: Orbitron, monospace;
      font-size: 16px;
      font-weight: 500;
      color: var(--bright-gold);
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* Slider Controls */
    .control-group {
      margin-bottom: 15px;
    }

    .control-label {
      display: block;
      font-size: 14px;
      font-weight: 400;
      color: var(--spark-white);
      margin-bottom: 8px;
    }

    .slider-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .slider {
      flex: 1;
      height: 6px;
      background: rgb(255, 255, 255, 20%);
      border-radius: 3px;
      outline: none;
      appearance: none;
      cursor: pointer;
    }

    .slider::-webkit-slider-thumb {
      appearance: none;
      width: 18px;
      height: 18px;
      background: linear-gradient(45deg, var(--neon-cyan), var(--bright-gold));
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 10px rgb(0, 245, 255, 50%);
      transition: all 0.2s ease;
    }

    .slider::-webkit-slider-thumb:hover {
      transform: scale(1.2);
      box-shadow: 0 0 15px rgb(0, 245, 255, 80%);
    }

    .value-display {
      font-family: Orbitron, monospace;
      font-size: 12px;
      color: var(--neon-cyan);
      min-width: 50px;
      text-align: right;
      background: rgb(0, 0, 0, 50%);
      padding: 4px 8px;
      border-radius: 4px;
    }

    /* Buttons */
    .control-button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(45deg, var(--fire-red), var(--bright-gold));
      color: var(--spark-white);
      border: none;
      border-radius: 8px;
      font-family: Orbitron, monospace;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgb(255, 71, 87, 30%);
    }

    .control-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgb(255, 71, 87, 50%);
    }

    .control-button:active {
      transform: translateY(0);
    }

    .button-row {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .button-row .control-button {
      flex: 1;
      padding: 10px;
      font-size: 12px;
    }

    .secondary-button {
      background: linear-gradient(45deg, var(--electric-blue), var(--neon-cyan)) !important;
      box-shadow: 0 4px 15px rgb(0, 245, 255, 30%) !important;
    }

    .secondary-button:hover {
      box-shadow: 0 8px 25px rgb(0, 245, 255, 50%) !important;
    }

    /* Touch Controls */
    .touch-controls {
      display: none;
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 150;
      background: var(--control-bg);
      backdrop-filter: blur(15px);
      border: 1px solid var(--control-border);
      border-radius: 25px;
      padding: 15px 20px;
      gap: 15px;
      align-items: center;
    }

    .touch-button {
      background: linear-gradient(45deg, var(--fire-red), var(--bright-gold));
      color: var(--spark-white);
      border: none;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgb(255, 71, 87, 30%);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .touch-button:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 25px rgb(255, 71, 87, 50%);
    }

    .touch-button.secondary {
      background: linear-gradient(45deg, var(--electric-blue), var(--neon-cyan));
      box-shadow: 0 4px 15px rgb(0, 245, 255, 30%);
    }

    .touch-button.secondary:hover {
      box-shadow: 0 8px 25px rgb(0, 245, 255, 50%);
    }

    /* Canvas Area */
    .canvas-area {
      width: 100%;
      height: 100%;
      position: relative;
    }

    #fireworks-canvas {
      display: block;
      width: 100% !important;
      height: 100% !important;
    }

    /* Performance Stats */
    .stats {
      position: absolute;
      top: 20px;
      right: 20px;
      background: var(--control-bg);
      backdrop-filter: blur(15px);
      border: 1px solid var(--control-border);
      border-radius: 10px;
      padding: 15px;
      font-family: Orbitron, monospace;
      font-size: 12px;
      color: var(--neon-cyan);
    }

    .stat-item {
      margin-bottom: 5px;
    }

    /* Loading Screen */
    .loading-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--night-black);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: opacity 0.5s ease;
    }

    .loading-text {
      font-family: Orbitron, monospace;
      font-size: 24px;
      color: var(--neon-cyan);
      text-shadow: 0 0 20px var(--neon-cyan);
      margin-bottom: 20px;
    }

    .loading-bar {
      width: 300px;
      height: 4px;
      background: rgb(255, 255, 255, 20%);
      border-radius: 2px;
      overflow: hidden;
    }

    .loading-progress {
      height: 100%;
      background: linear-gradient(90deg, var(--neon-cyan), var(--bright-gold));
      width: 0%;
      transition: width 0.3s ease;
      box-shadow: 0 0 10px var(--neon-cyan);
    }

    /* Responsive Design */
    @media (width <=768px) {
      .control-panel {
        display: none;

        /* å®Œå…¨éšè—æ§åˆ¶é¢æ¿ */
      }

      .control-panel.show {
        display: block;

        /* åªæœ‰åœ¨æ˜¾ç¤ºçŠ¶æ€æ—¶æ‰æ˜¾ç¤º */
        width: calc(100% - 40px);
        max-width: 350px;
        position: fixed;
        top: 80px;
        left: 20px;
        transform: translateX(0);
        transition: all 0.3s ease;
        max-height: calc(100vh - 200px);
        overflow-y: auto;
        z-index: 150;
        background: var(--control-bg);
        backdrop-filter: blur(15px);
        border: 1px solid var(--control-border);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgb(0, 0, 0, 50%);
      }

      .mobile-toggle {
        display: flex;
        z-index: 200;

        /* ç¡®ä¿æŒ‰é’®åœ¨æœ€ä¸Šå±‚ */
      }

      .touch-controls {
        display: flex;
        z-index: 150;

        /* ç¡®ä¿è§¦æ‘¸æ§åˆ¶å¯è§ */
      }

      .stats {
        top: 20px;
        right: 80px;
        font-size: 10px;
        padding: 10px;
        z-index: 100;
      }

      .panel-title {
        font-size: 20px;
      }

      .section-title {
        font-size: 14px;
      }

      .control-label {
        font-size: 12px;
      }

      .value-display {
        font-size: 10px;
        min-width: 40px;
      }

      .control-button {
        padding: 10px;
        font-size: 12px;
      }

      /* ä¼˜åŒ–æ»‘å—åœ¨ç§»åŠ¨ç«¯çš„è§¦æ‘¸ä½“éªŒ */
      .slider::-webkit-slider-thumb {
        width: 24px;
        height: 24px;
      }

      /* éšè—æ¡Œé¢ç«¯çš„ä¸€äº›æ§åˆ¶æŒ‰é’® */
      .button-row {
        flex-direction: column;
        gap: 8px;
      }
    }

    @media (width <=480px) {
      .control-panel {
        display: none;

        /* å®Œå…¨éšè— */
      }

      .control-panel.show {
        display: block;

        /* æ˜¾ç¤ºæ—¶çš„æ ·å¼ */
        width: calc(100% - 20px);
        left: 10px;
        top: 70px;
        z-index: 150;
        background: var(--control-bg);
        backdrop-filter: blur(15px);
        border: 1px solid var(--control-border);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgb(0, 0, 0, 50%);
        max-height: calc(100vh - 200px);
        overflow-y: auto;
      }

      .mobile-toggle {
        left: 10px;
        top: 10px;
        width: 45px;
        height: 45px;
        font-size: 18px;
        z-index: 200;
      }

      .stats {
        right: 65px;
        top: 10px;
        padding: 8px;
        z-index: 100;
      }

      .touch-controls {
        bottom: 10px;
        padding: 10px 15px;
        z-index: 150;
      }

      .touch-button {
        width: 45px;
        height: 45px;
        font-size: 18px;
      }

      .panel-title {
        font-size: 18px;
      }

      .control-section {
        padding: 12px;
        margin-bottom: 15px;
      }
    }

    /* æ¨ªå±æ¨¡å¼ä¼˜åŒ– */
    @media (height <=500px) and (orientation: landscape) {
      .control-panel {
        display: none;

        /* æ¨ªå±æ—¶ä¹Ÿå®Œå…¨éšè— */
      }

      .control-panel.show {
        display: block;
        max-height: calc(100vh - 120px);
        font-size: 12px;
        z-index: 150;
        background: var(--control-bg);
        backdrop-filter: blur(15px);
        border: 1px solid var(--control-border);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgb(0, 0, 0, 50%);
        overflow-y: auto;
      }

      .control-section {
        padding: 10px;
        margin-bottom: 10px;
      }

      .section-title {
        font-size: 12px;
        margin-bottom: 8px;
      }

      .control-group {
        margin-bottom: 8px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Mobile Toggle Button -->
    <!-- <button class="mobile-toggle" id="mobile-toggle" onclick="toggleControlPanel()">
      âš™ï¸
    </button> -->

    <!-- Loading Screen -->
    <div class="loading-screen" id="loading-screen">
      <div class="loading-text">æ­£åœ¨è¿›å…¥çƒŸèŠ±ç§€...</div>
      <div class="loading-bar">
        <div class="loading-progress" id="loading-progress"></div>
      </div>
    </div>

    <!-- Control Panel -->
    <div class="control-panel" id="control-panel">
      <div class="panel-header">
        <div class="panel-title">çƒŸèŠ±ç§€</div>
        <div class="panel-subtitle">Fireworks Symphony</div>
      </div>

      <!-- Launch Controls -->
      <div class="control-section">
        <div class="section-title">å‘å°„æ§åˆ¶</div>

        <div class="control-group">
          <label class="control-label">å‘å°„é¢‘ç‡</label>
          <div class="slider-container">
            <input type="range" class="slider" id="launchRate" min="0.1" max="2.0" step="0.1" value="0.8">
            <span class="value-display" id="launchRate-value">0.8</span>
          </div>
        </div>

        <div class="control-group">
          <label class="control-label">çˆ†ç‚¸å¼ºåº¦</label>
          <div class="slider-container">
            <input type="range" class="slider" id="explosionPower" min="50" max="200" step="10" value="120">
            <span class="value-display" id="explosionPower-value">120</span>
          </div>
        </div>

        <div class="control-group">
          <label class="control-label">ç²’å­æ•°é‡</label>
          <div class="slider-container">
            <input type="range" class="slider" id="particleCount" min="20" max="100" step="5" value="50">
            <span class="value-display" id="particleCount-value">50</span>
          </div>
        </div>
      </div>

      <!-- Visual Effects -->
      <div class="control-section">
        <div class="section-title">è§†è§‰æ•ˆæœ</div>

        <div class="control-group">
          <label class="control-label">é‡åŠ›å¼ºåº¦</label>
          <div class="slider-container">
            <input type="range" class="slider" id="gravity" min="0.05" max="0.3" step="0.01" value="0.15">
            <span class="value-display" id="gravity-value">0.15</span>
          </div>
        </div>

        <div class="control-group">
          <label class="control-label">æ‹–å°¾é•¿åº¦</label>
          <div class="slider-container">
            <input type="range" class="slider" id="trailLength" min="0.8" max="0.98" step="0.01" value="0.92">
            <span class="value-display" id="trailLength-value">0.92</span>
          </div>
        </div>

        <div class="control-group">
          <label class="control-label">é—ªçƒå¼ºåº¦</label>
          <div class="slider-container">
            <input type="range" class="slider" id="sparkleIntensity" min="0" max="1" step="0.1" value="0.6">
            <span class="value-display" id="sparkleIntensity-value">0.6</span>
          </div>
        </div>

        <div class="control-group">
          <label class="control-label">ç¥ç¦è¯­æ¦‚ç‡</label>
          <div class="slider-container">
            <input type="range" class="slider" id="blessingChance" min="0" max="1" step="0.1" value="0.3">
            <span class="value-display" id="blessingChance-value">0.3</span>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="control-section">
        <button class="control-button" onclick="launchFirework()">ğŸ† å‘å°„çƒŸèŠ±</button>
        <div class="button-row">
          <button class="control-button secondary-button" onclick="launchBurst()">è¿å‘</button>
          <button class="control-button secondary-button" onclick="clearScreen()">æ¸…å±</button>
        </div>
        <!-- <button class="control-button tertiary" onclick="showRandomBlessing()"
          style="background: linear-gradient(45deg, var(--bright-gold), var(--fire-red)) !important; margin-top: 10px;">ğŸ
          é©¬å¹´ç¥ç¦</button> -->
      </div>
    </div>

    <!-- Performance Stats -->
    <div class="stats" id="stats">
      <div class="stat-item">FPS: <span id="fps">60</span></div>
      <div class="stat-item">çƒŸèŠ±: <span id="firework-count">0</span></div>
      <div class="stat-item">ç²’å­: <span id="particle-count">0</span></div>
    </div>

    <!-- Touch Controls for Mobile -->
    <div class="touch-controls" id="touch-controls">
      <button class="touch-button" id="launch-btn" title="å‘å°„çƒŸèŠ±">ğŸ†</button>
      <button class="touch-button secondary" id="burst-btn" title="è¿å‘">ğŸ’¥</button>
      <!-- <button class="touch-button secondary" id="blessing-btn" title="é©¬å¹´ç¥ç¦">ğŸ</button> -->
      <button class="touch-button secondary" id="clear-btn" title="æ¸…å±">ğŸ§¹</button>
    </div>

    <!-- Canvas Area -->
    <div class="canvas-area">
      <div id="fireworks-canvas"></div>
    </div>
  </div>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // çƒŸèŠ±ç§€å‚æ•°é…ç½®
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    let params = {
      launchRate: 0.8,
      explosionPower: 120,
      particleCount: 50,
      gravity: 0.15,
      trailLength: 0.92,
      sparkleIntensity: 0.6,
      blessingChance: 0.3
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å…¨å±€å˜é‡
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    let fireworks = [];
    let particles = [];
    let lastLaunch = 0;
    let frameCounter = 0;
    let lastFPSUpdate = 0;
    let blessings = []; // å­˜å‚¨å½“å‰æ˜¾ç¤ºçš„ç¥ç¦è¯­

    // é¢œè‰²è°ƒè‰²æ¿ - æ›´ä¸°å¯Œçš„è‰²å½©ç»„åˆ
    const colorPalettes = [
      // ç»å…¸çƒŸèŠ±è‰²å½©
      ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#fd79a8'],
      // ç´«è‰²æ¢¦å¹»
      ['#a29bfe', '#6c5ce7', '#fd79a8', '#fdcb6e', '#e84393', '#74b9ff'],
      // ç»¿è‰²è‡ªç„¶
      ['#00b894', '#00cec9', '#55a3ff', '#6c5ce7', '#e17055', '#fdcb6e'],
      // æš–è‰²ç³»
      ['#ff7675', '#fd79a8', '#fdcb6e', '#e17055', '#ff6348', '#ffa502'],
      // å†·è‰²ç³»
      ['#74b9ff', '#0984e3', '#00cec9', '#6c5ce7', '#a29bfe', '#55a3ff'],
      // å½©è™¹è‰²
      ['#ff0000', '#ff8000', '#ffff00', '#80ff00', '#00ff80', '#0080ff', '#8000ff'],
      // é‡‘è‰²å¥¢å
      ['#f39c12', '#e67e22', '#d35400', '#f1c40f', '#e74c3c', '#c0392b'],
      // é“¶è‰²ä¼˜é›…
      ['#bdc3c7', '#95a5a6', '#7f8c8d', '#ecf0f1', '#d5dbdb', '#85929e']
    ];

    // ç‰¹æ®ŠçƒŸèŠ±ç±»å‹
    const fireworkTypes = [
      'burst',      // çˆ†ç‚¸å‹
      'willow',     // æŸ³æ ‘å‹
      'chrysanthemum', // èŠèŠ±å‹
      'palm',       // æ£•æ¦ˆå‹
      'ring',       // ç¯å½¢
      'heart',      // å¿ƒå½¢
      'star'        // æ˜Ÿå½¢
    ];

    // é©¬å¹´ç¥ç¦è¯­
    const horseYearBlessings = [
      'é©¬åˆ°æˆåŠŸ',
      'é¾™é©¬ç²¾ç¥',
      'ä¸€é©¬å½“å…ˆ',
      'ä¸‡é©¬å¥”è…¾',
      'é©¬å¹´å¤§å‰',
      'å¿«é©¬åŠ é­',
      'é©¬ä¸Šæœ‰é’±',
      'é©¬ä¸Šæœ‰ç¦',
      'é©¬ä¸Šæœ‰å–œ',
      'é©¬ä¸Šæœ‰çˆ±',
      'åƒé‡Œé©¬é‡ä¼¯ä¹',
      'é©¬è¸é£ç‡•',
      'é©¬ä¸åœè¹„',
      'é©¬å¹´è¡Œå¤§è¿',
      'éªé©¬å¥”è…¾',
      'é©¬ä¸ŠæˆåŠŸ',
      'é©¬å¹´å¦‚æ„',
      'é©¬ä¸Šå¹¸ç¦',
      'é©¬å¹´å‘è´¢',
      'é©¬ä¸Šå‡èŒ',
      'é©¬å¹´å¥åº·',
      'é©¬ä¸Šå¿ƒæƒ³äº‹æˆ',
      'é©¬å¹´ä¸‡äº‹å¦‚æ„',
      'é©¬ä¸Šå¥½è¿è¿è¿',
      'é©¬å¹´æ­¥æ­¥é«˜å‡'
    ];

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // P5.js ä¸»è¦å‡½æ•°
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function setup() {
      let canvas = createCanvas(windowWidth, windowHeight);
      canvas.parent('fireworks-canvas');

      // åˆå§‹åŒ–åŠ è½½è¿›åº¦
      simulateLoading();

      // è®¾ç½®åˆå§‹èƒŒæ™¯
      background(10, 10, 15);

      // åˆå§‹åŒ–æ§åˆ¶å™¨
      initializeControls();

      // ä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒ
      optimizeForMobile();

      // åˆå§‹åŒ–è§¦æ‘¸æŒ‰é’®ï¼ˆå¤‡ç”¨æ–¹æ¡ˆï¼‰
      initializeTouchButtons();
    }

    function draw() {
      // åˆ›å»ºæ‹–å°¾æ•ˆæœ
      fill(10, 10, 15, (1 - params.trailLength) * 255);
      noStroke();
      rect(0, 0, width, height);

      // è‡ªåŠ¨å‘å°„çƒŸèŠ±
      if (millis() - lastLaunch > 1000 / params.launchRate) {
        if (random() < 0.7) { // 70% æ¦‚ç‡è‡ªåŠ¨å‘å°„
          launchRandomFirework();
        }
        lastLaunch = millis();
      }

      // æ›´æ–°å’Œç»˜åˆ¶çƒŸèŠ±
      for (let i = fireworks.length - 1; i >= 0; i--) {
        fireworks[i].update();
        fireworks[i].display();

        if (fireworks[i].exploded && fireworks[i].particles.length === 0) {
          fireworks.splice(i, 1);
        }
      }

      // æ›´æ–°å’Œç»˜åˆ¶ç¥ç¦è¯­
      for (let i = blessings.length - 1; i >= 0; i--) {
        blessings[i].update();
        blessings[i].display();

        if (blessings[i].isDead()) {
          blessings.splice(i, 1);
        }
      }

      // æ€§èƒ½ä¼˜åŒ–ï¼šå®šæœŸæ¸…ç†è¶…å‡ºå±å¹•èŒƒå›´çš„çƒŸèŠ±
      if (frameCount % 60 === 0) { // æ¯ç§’æ£€æŸ¥ä¸€æ¬¡
        cleanupOffscreenFireworks();
      }

      // æ›´æ–°æ€§èƒ½ç»Ÿè®¡
      updateStats();
    }

    function windowResized() {
      resizeCanvas(windowWidth, windowHeight);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // çƒŸèŠ±ç±»å®šä¹‰
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    class Firework {
      constructor(x, y, targetX, targetY, colors, type) {
        this.x = x;
        this.y = y;
        this.targetX = targetX;
        this.targetY = targetY;
        this.colors = colors || random(colorPalettes);
        this.type = type || random(fireworkTypes);

        // å‘å°„é˜¶æ®µ
        this.exploded = false;
        this.vx = (targetX - x) * 0.01;
        this.vy = (targetY - y) * 0.01;

        // çˆ†ç‚¸ç²’å­
        this.particles = [];

        // è§†è§‰æ•ˆæœ
        this.trail = [];
        this.brightness = 255;
        this.size = random(6, 12);

        // éŸ³æ•ˆæ¨¡æ‹Ÿï¼ˆè§†è§‰åé¦ˆï¼‰
        this.shockwave = 0;
        this.shockwaveMax = random(50, 100);
      }

      update() {
        if (!this.exploded) {
          // å‘å°„é˜¶æ®µ
          this.x += this.vx;
          this.y += this.vy;
          this.vy += 0.02; // è½»å¾®é‡åŠ›å½±å“

          // æ·»åŠ æ‹–å°¾
          this.trail.push({
            x: this.x,
            y: this.y,
            brightness: this.brightness,
            size: this.size * 0.5
          });
          if (this.trail.length > 15) {
            this.trail.shift();
          }

          // æ£€æŸ¥æ˜¯å¦åˆ°è¾¾ç›®æ ‡æˆ–éœ€è¦å¼ºåˆ¶çˆ†ç‚¸
          let distance = dist(this.x, this.y, this.targetX, this.targetY);
          let shouldExplode = false;

          // åˆ°è¾¾ç›®æ ‡ç‚¹
          if (distance < 8) {
            shouldExplode = true;
          }

          // å¼€å§‹ä¸‹é™æ—¶çˆ†ç‚¸ï¼ˆé˜²æ­¢é£å‡ºå±å¹•é¡¶éƒ¨ï¼‰
          if (this.vy > 0) {
            shouldExplode = true;
          }

          // è¾¹ç•Œæ£€æŸ¥ - é˜²æ­¢çƒŸèŠ±é£å‡ºå±å¹•
          if (this.x < 0 || this.x > width || this.y < 0 || this.y > height) {
            shouldExplode = true;
          }

          // å¦‚æœçƒŸèŠ±é£å¾—å¤ªé«˜ï¼ˆè¶…å‡ºç›®æ ‡ç‚¹å¾ˆå¤šï¼‰
          if (this.y < this.targetY - 50) {
            shouldExplode = true;
          }

          if (shouldExplode) {
            // ç¡®ä¿çˆ†ç‚¸ç‚¹åœ¨å±å¹•èŒƒå›´å†…
            this.x = constrain(this.x, 50, width - 50);
            this.y = constrain(this.y, 50, height - 100);
            this.explode();
          }
        } else {
          // çˆ†ç‚¸é˜¶æ®µ - æ›´æ–°ç²’å­
          for (let i = this.particles.length - 1; i >= 0; i--) {
            this.particles[i].update();
            if (this.particles[i].isDead()) {
              this.particles.splice(i, 1);
            }
          }

          // æ›´æ–°å†²å‡»æ³¢
          if (this.shockwave < this.shockwaveMax) {
            this.shockwave += 3;
          }
        }
      }

      display() {
        if (!this.exploded) {
          // ç»˜åˆ¶å‘å°„æ‹–å°¾ - æ›´åä¸½
          for (let i = 0; i < this.trail.length; i++) {
            let alpha = map(i, 0, this.trail.length - 1, 0, 255);
            let size = map(i, 0, this.trail.length - 1, 2, this.size);
            let trail = this.trail[i];

            // ä¸»æ‹–å°¾
            fill(255, 255, 255, alpha);
            noStroke();
            ellipse(trail.x, trail.y, size);

            // å†…æ ¸å…‰èŠ’
            fill(255, 255, 100, alpha * 0.7);
            ellipse(trail.x, trail.y, size * 0.6);
          }

          // ç»˜åˆ¶ä¸»ä½“ - æ›´äº®æ›´å¤§
          fill(255, 255, 255, this.brightness);
          ellipse(this.x, this.y, this.size);

          // å†…æ ¸
          fill(255, 255, 150, this.brightness);
          ellipse(this.x, this.y, this.size * 0.6);

          // æ·»åŠ å…‰æ™•æ•ˆæœ - å¤šå±‚å…‰æ™•
          for (let r = this.size * 3; r > 0; r -= this.size * 0.5) {
            fill(255, 255, 255, 15);
            ellipse(this.x, this.y, r);
          }
        } else {
          // ç»˜åˆ¶å†²å‡»æ³¢
          if (this.shockwave < this.shockwaveMax) {
            stroke(255, 255, 255, 100 - (this.shockwave / this.shockwaveMax) * 100);
            strokeWeight(3);
            noFill();
            ellipse(this.x, this.y, this.shockwave * 2);

            stroke(255, 255, 150, 50 - (this.shockwave / this.shockwaveMax) * 50);
            strokeWeight(1);
            ellipse(this.x, this.y, this.shockwave * 2.5);
          }

          // ç»˜åˆ¶çˆ†ç‚¸ç²’å­
          for (let particle of this.particles) {
            particle.display();
          }
        }
      }

      explode() {
        this.exploded = true;

        // æ ¹æ®ç±»å‹åˆ›å»ºä¸åŒçš„çˆ†ç‚¸æ¨¡å¼
        this.createExplosionByType();

        // æ·»åŠ é¢å¤–çš„é—ªçƒç²’å­
        if (params.sparkleIntensity > 0) {
          let sparkleCount = int(params.particleCount * params.sparkleIntensity * 0.3);
          for (let i = 0; i < sparkleCount; i++) {
            let angle = random(TWO_PI);
            let speed = random(1, 4);
            let vx = cos(angle) * speed;
            let vy = sin(angle) * speed;

            this.particles.push(new SparkleParticle(this.x, this.y, vx, vy));
          }
        }

        // éšæœºç”Ÿæˆç¥ç¦è¯­
        if (random() < params.blessingChance) {
          let blessing = random(horseYearBlessings);
          let offsetX = random(-50, 50);
          let offsetY = random(-30, 30);
          blessings.push(new BlessingText(this.x + offsetX, this.y + offsetY, blessing));
          console.log('ç”Ÿæˆç¥ç¦è¯­:', blessing);
        }
      }

      createExplosionByType() {
        let particleCount = params.particleCount;

        switch (this.type) {
          case 'burst':
            this.createBurstExplosion(particleCount);
            break;
          case 'willow':
            this.createWillowExplosion(particleCount);
            break;
          case 'chrysanthemum':
            this.createChrysanthemumExplosion(particleCount);
            break;
          case 'palm':
            this.createPalmExplosion(particleCount);
            break;
          case 'ring':
            this.createRingExplosion(particleCount);
            break;
          case 'heart':
            this.createHeartExplosion(particleCount);
            break;
          case 'star':
            this.createStarExplosion(particleCount);
            break;
          default:
            this.createBurstExplosion(particleCount);
        }
      }

      createBurstExplosion(count) {
        for (let i = 0; i < count; i++) {
          let angle = map(i, 0, count, 0, TWO_PI);
          let speed = random(2, params.explosionPower / 15);

          let vx = cos(angle) * speed;
          let vy = sin(angle) * speed;

          let color = random(this.colors);
          this.particles.push(new Particle(this.x, this.y, vx, vy, color));
        }
      }

      createWillowExplosion(count) {
        for (let i = 0; i < count; i++) {
          let angle = map(i, 0, count, 0, TWO_PI);
          let speed = random(1, params.explosionPower / 25);

          let vx = cos(angle) * speed;
          let vy = sin(angle) * speed - random(1, 3); // å‘ä¸Šåç§»

          let color = random(this.colors);
          this.particles.push(new WillowParticle(this.x, this.y, vx, vy, color));
        }
      }

      createChrysanthemumExplosion(count) {
        let layers = 3;
        for (let layer = 0; layer < layers; layer++) {
          let layerCount = count / layers;
          let radius = (layer + 1) * params.explosionPower / 60;

          for (let i = 0; i < layerCount; i++) {
            let angle = map(i, 0, layerCount, 0, TWO_PI);
            let vx = cos(angle) * radius;
            let vy = sin(angle) * radius;

            let color = random(this.colors);
            this.particles.push(new Particle(this.x, this.y, vx, vy, color));
          }
        }
      }

      createPalmExplosion(count) {
        let branches = 5;
        for (let branch = 0; branch < branches; branch++) {
          let branchAngle = map(branch, 0, branches, 0, TWO_PI);
          let branchCount = count / branches;

          for (let i = 0; i < branchCount; i++) {
            let spread = random(-0.3, 0.3);
            let angle = branchAngle + spread;
            let speed = random(2, params.explosionPower / 20);

            let vx = cos(angle) * speed;
            let vy = sin(angle) * speed;

            let color = random(this.colors);
            this.particles.push(new Particle(this.x, this.y, vx, vy, color));
          }
        }
      }

      createRingExplosion(count) {
        for (let i = 0; i < count; i++) {
          let angle = map(i, 0, count, 0, TWO_PI);
          let speed = params.explosionPower / 20;

          let vx = cos(angle) * speed;
          let vy = sin(angle) * speed;

          let color = random(this.colors);
          this.particles.push(new Particle(this.x, this.y, vx, vy, color));
        }
      }

      createHeartExplosion(count) {
        for (let i = 0; i < count; i++) {
          let t = map(i, 0, count, 0, TWO_PI);
          let x = 16 * pow(sin(t), 3);
          let y = -(13 * cos(t) - 5 * cos(2 * t) - 2 * cos(3 * t) - cos(4 * t));

          let speed = params.explosionPower / 400;
          let vx = x * speed;
          let vy = y * speed;

          let color = random(this.colors);
          this.particles.push(new Particle(this.x, this.y, vx, vy, color));
        }
      }

      createStarExplosion(count) {
        let points = 5;
        for (let point = 0; point < points; point++) {
          let pointAngle = map(point, 0, points, 0, TWO_PI);
          let pointCount = count / points;

          for (let i = 0; i < pointCount; i++) {
            let spread = random(-0.1, 0.1);
            let angle = pointAngle + spread;
            let speed = random(3, params.explosionPower / 15);

            let vx = cos(angle) * speed;
            let vy = sin(angle) * speed;

            let color = random(this.colors);
            this.particles.push(new Particle(this.x, this.y, vx, vy, color));
          }
        }
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ç²’å­ç±»å®šä¹‰
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    class Particle {
      constructor(x, y, vx, vy, color) {
        this.x = x;
        this.y = y;
        this.vx = vx;
        this.vy = vy;
        this.color = color;
        this.life = 255;
        this.decay = random(1.5, 4);
        this.size = random(2, 8);
        this.trail = [];
        this.brightness = random(0.8, 1.0);
        this.twinkle = random(0.1, 0.3);
        this.twinkleTimer = 0;
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vy += params.gravity; // é‡åŠ›
        this.vx *= 0.985; // ç©ºæ°”é˜»åŠ›

        this.life -= this.decay;
        this.twinkleTimer += this.twinkle;

        // è¾¹ç•Œæ£€æŸ¥ - å¦‚æœç²’å­é£å‡ºå±å¹•å¤ªè¿œï¼ŒåŠ é€Ÿè¡°å‡
        if (this.x < -50 || this.x > width + 50 || this.y > height + 50) {
          this.life -= 10; // åŠ é€Ÿè¡°å‡
        }

        // æ·»åŠ æ‹–å°¾
        this.trail.push({
          x: this.x,
          y: this.y,
          life: this.life,
          size: this.size * 0.7
        });
        if (this.trail.length > 8) {
          this.trail.shift();
        }
      }

      display() {
        // ç»˜åˆ¶æ‹–å°¾ - æ›´é•¿æ›´åä¸½
        for (let i = 0; i < this.trail.length; i++) {
          let alpha = map(i, 0, this.trail.length - 1, 0, this.life * 0.8);
          let size = map(i, 0, this.trail.length - 1, 1, this.trail[i].size);

          fill(red(this.color), green(this.color), blue(this.color), alpha);
          noStroke();
          ellipse(this.trail[i].x, this.trail[i].y, size);
        }

        // è®¡ç®—é—ªçƒæ•ˆæœ
        let twinkleEffect = (sin(this.twinkleTimer) + 1) * 0.5;
        let currentBrightness = this.brightness * (0.7 + 0.3 * twinkleEffect);

        // ç»˜åˆ¶ä¸»ä½“ - æ›´äº®æ›´æœ‰å±‚æ¬¡
        let mainAlpha = this.life * currentBrightness;
        fill(red(this.color), green(this.color), blue(this.color), mainAlpha);
        ellipse(this.x, this.y, this.size);

        // å†…æ ¸é«˜äº®
        fill(255, 255, 255, mainAlpha * 0.6);
        ellipse(this.x, this.y, this.size * 0.4);

        // æ·»åŠ å…‰æ™• - å¤šå±‚å…‰æ™•
        if (this.life > 50) {
          for (let r = this.size * 2; r > this.size; r -= this.size * 0.3) {
            let haloAlpha = (this.life * 0.2) * (r / (this.size * 2));
            fill(red(this.color), green(this.color), blue(this.color), haloAlpha);
            ellipse(this.x, this.y, r);
          }
        }
      }

      isDead() {
        return this.life <= 0;
      }
    }

    class WillowParticle extends Particle {
      constructor(x, y, vx, vy, color) {
        super(x, y, vx, vy, color);
        this.decay = random(0.8, 2); // æ›´æ…¢çš„è¡°å‡
        this.size = random(1, 4); // æ›´å°çš„ç²’å­
        this.dragCoeff = 0.95; // æ›´å¼ºçš„é˜»åŠ›
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vy += params.gravity * 1.2; // æ›´å¼ºçš„é‡åŠ›
        this.vx *= this.dragCoeff;
        this.vy *= this.dragCoeff;

        this.life -= this.decay;
        this.twinkleTimer += this.twinkle;

        // è¾¹ç•Œæ£€æŸ¥ - æŸ³æ ‘ç²’å­é£å‡ºå±å¹•æ—¶åŠ é€Ÿè¡°å‡
        if (this.x < -50 || this.x > width + 50 || this.y > height + 50) {
          this.life -= 8; // åŠ é€Ÿè¡°å‡
        }

        // æ›´é•¿çš„æ‹–å°¾
        this.trail.push({
          x: this.x,
          y: this.y,
          life: this.life,
          size: this.size * 0.5
        });
        if (this.trail.length > 12) {
          this.trail.shift();
        }
      }

      display() {
        // ç»˜åˆ¶æ›´é•¿çš„æ‹–å°¾
        for (let i = 0; i < this.trail.length; i++) {
          let alpha = map(i, 0, this.trail.length - 1, 0, this.life * 0.9);
          let size = map(i, 0, this.trail.length - 1, 0.5, this.trail[i].size);

          fill(red(this.color), green(this.color), blue(this.color), alpha);
          noStroke();
          ellipse(this.trail[i].x, this.trail[i].y, size);
        }

        // ä¸»ä½“æ›´å°æ›´æŸ”å’Œ
        let twinkleEffect = (sin(this.twinkleTimer) + 1) * 0.5;
        let currentBrightness = this.brightness * (0.6 + 0.4 * twinkleEffect);
        let mainAlpha = this.life * currentBrightness;

        fill(red(this.color), green(this.color), blue(this.color), mainAlpha);
        ellipse(this.x, this.y, this.size);
      }
    }

    class SparkleParticle extends Particle {
      constructor(x, y, vx, vy) {
        super(x, y, vx, vy, '#ffffff');
        this.sparkle = true;
        this.sparkleTimer = 0;
        this.sparkleSpeed = random(0.15, 0.4);
        this.size = random(1, 4);
        this.decay = random(3, 6);
      }

      update() {
        super.update();
        this.sparkleTimer += this.sparkleSpeed;
      }

      display() {
        this.sparkleTimer += this.sparkleSpeed;
        let sparkleAlpha = (sin(this.sparkleTimer) + 1) * 0.5 * this.life;

        // ä¸»é—ªçƒ
        fill(255, 255, 255, sparkleAlpha);
        noStroke();

        // ç»˜åˆ¶åå­—æ˜Ÿå½¢é—ªçƒ
        push();
        translate(this.x, this.y);

        // æ°´å¹³çº¿
        rect(-this.size, -this.size * 0.2, this.size * 2, this.size * 0.4);
        // å‚ç›´çº¿
        rect(-this.size * 0.2, -this.size, this.size * 0.4, this.size * 2);

        // å¯¹è§’çº¿
        rotate(PI / 4);
        rect(-this.size * 0.7, -this.size * 0.15, this.size * 1.4, this.size * 0.3);
        rect(-this.size * 0.15, -this.size * 0.7, this.size * 0.3, this.size * 1.4);

        pop();

        // æ·»åŠ å…‰æ™•
        fill(255, 255, 255, sparkleAlpha * 0.3);
        ellipse(this.x, this.y, this.size * 3);
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ç¥ç¦è¯­ç±»å®šä¹‰
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    class BlessingText {
      constructor(x, y, text) {
        this.x = x;
        this.y = y;
        this.text = text;
        this.color = random(['#FFD700', '#FF6B6B', '#4ECDC4', '#45B7D1', '#FD79A8', '#FDCB6E']);

        // ç®€å•çš„æ˜¾ç¤ºå’Œæ¶ˆå¤±æ•ˆæœ
        this.initialSize = random(32, 48);
        this.scale = 0;
        this.scaleSpeed = 0.1;
        this.life = 180; // æ€»ç”Ÿå‘½å‘¨æœŸï¼ˆ3ç§’ï¼‰
        this.maxLife = 180;
        this.alpha = 255;
      }

      update() {
        // æ”¾å¤§é˜¶æ®µ
        if (this.scale < 1) {
          this.scale += this.scaleSpeed;
          if (this.scale >= 1) {
            this.scale = 1;
          }
        }

        // ç”Ÿå‘½å‘¨æœŸé€’å‡
        this.life--;

        // æœ€å30å¸§å¼€å§‹æ·¡å‡º
        if (this.life < 30) {
          this.alpha = map(this.life, 0, 30, 0, 255);
        }
      }

      display() {
        push();
        translate(this.x, this.y);
        scale(this.scale);

        // å‘å…‰æ•ˆæœ
        for (let i = 3; i > 0; i--) {
          fill(red(this.color), green(this.color), blue(this.color), (this.alpha * 0.4) / i);
          textAlign(CENTER, CENTER);
          textSize(this.initialSize + i * 2);
          textStyle(BOLD);
          text(this.text, 0, 0);
        }

        // ä¸»æ–‡å­—
        fill(255, 255, 255, this.alpha);
        textAlign(CENTER, CENTER);
        textSize(this.initialSize);
        textStyle(BOLD);
        text(this.text, 0, 0);

        pop();
      }

      isDead() {
        return this.life <= 0;
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // æ§åˆ¶å‡½æ•°
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function launchFirework() {
      let startX = random(width * 0.2, width * 0.8);
      let startY = height;

      // ç¡®ä¿ç›®æ ‡ç‚¹åœ¨å®‰å…¨çš„å¯è§†èŒƒå›´å†…
      let targetX = random(width * 0.15, width * 0.85);
      let targetY = random(height * 0.15, height * 0.65);

      // è¿›ä¸€æ­¥çº¦æŸï¼Œç¡®ä¿ä¸ä¼šå¤ªé è¿‘è¾¹ç¼˜
      targetX = constrain(targetX, 100, width - 100);
      targetY = constrain(targetY, 80, height - 150);

      // éšæœºé€‰æ‹©çƒŸèŠ±ç±»å‹å’Œé¢œè‰²
      let type = random(fireworkTypes);
      let colors = random(colorPalettes);

      fireworks.push(new Firework(startX, startY, targetX, targetY, colors, type));
    }

    function launchRandomFirework() {
      launchFirework();
    }

    function launchBurst() {
      // è¿å‘æ—¶ä½¿ç”¨ä¸åŒçš„ç±»å‹å’Œé¢œè‰²
      for (let i = 0; i < 5; i++) {
        setTimeout(() => {
          let startX = random(width * 0.15, width * 0.85);
          let startY = height;

          // ç¡®ä¿è¿å‘æ—¶çš„ç›®æ ‡ç‚¹åˆ†å¸ƒæ›´åˆç†
          let targetX = random(width * 0.2, width * 0.8);
          let targetY = random(height * 0.2, height * 0.7);

          // çº¦æŸåœ¨å®‰å…¨èŒƒå›´å†…
          targetX = constrain(targetX, 100, width - 100);
          targetY = constrain(targetY, 80, height - 150);

          let type = random(fireworkTypes);
          let colors = random(colorPalettes);

          fireworks.push(new Firework(startX, startY, targetX, targetY, colors, type));
        }, i * 150); // ç¨å¾®å¿«ä¸€ç‚¹çš„é—´éš”
      }
    }

    function clearScreen() {
      fireworks = [];
      particles = [];
      blessings = []; // æ¸…ç†ç¥ç¦è¯­
      background(10, 10, 15);
    }

    // æ‰‹åŠ¨æ˜¾ç¤ºéšæœºç¥ç¦è¯­
    function showRandomBlessing() {
      let blessing = random(horseYearBlessings);
      let x = random(width * 0.2, width * 0.8);
      let y = random(height * 0.3, height * 0.7);
      blessings.push(new BlessingText(x, y, blessing));
      console.log('æ‰‹åŠ¨ç”Ÿæˆç¥ç¦è¯­:', blessing);
    }

    // æ€§èƒ½ä¼˜åŒ–ï¼šæ¸…ç†è¶…å‡ºå±å¹•èŒƒå›´çš„çƒŸèŠ±
    function cleanupOffscreenFireworks() {
      for (let i = fireworks.length - 1; i >= 0; i--) {
        let fw = fireworks[i];

        // å¦‚æœçƒŸèŠ±è¿˜åœ¨å‘å°„é˜¶æ®µä½†å·²ç»è¶…å‡ºå±å¹•èŒƒå›´å¾ˆè¿œ
        if (!fw.exploded) {
          if (fw.x < -100 || fw.x > width + 100 || fw.y < -100 || fw.y > height + 100) {
            fireworks.splice(i, 1);
            continue;
          }
        }

        // å¦‚æœçƒŸèŠ±å·²çˆ†ç‚¸ï¼Œæ£€æŸ¥æ˜¯å¦æ‰€æœ‰ç²’å­éƒ½å·²æ¶ˆå¤±æˆ–è¶…å‡ºèŒƒå›´
        if (fw.exploded) {
          let activeParticles = 0;
          for (let particle of fw.particles) {
            if (particle.life > 0 &&
              particle.x > -100 && particle.x < width + 100 &&
              particle.y > -100 && particle.y < height + 100) {
              activeParticles++;
            }
          }

          // å¦‚æœæ²¡æœ‰æ´»è·ƒç²’å­åœ¨å±å¹•èŒƒå›´å†…ï¼Œç§»é™¤çƒŸèŠ±
          if (activeParticles === 0) {
            fireworks.splice(i, 1);
          }
        }
      }
    }

    function launchFireworkToPosition(targetX, targetY) {
      let startX = random(width * 0.2, width * 0.8);
      let startY = height;

      // ç¡®ä¿ç”¨æˆ·ç‚¹å‡»çš„ç›®æ ‡ç‚¹åœ¨å®‰å…¨èŒƒå›´å†…
      targetX = constrain(targetX, 100, width - 100);
      targetY = constrain(targetY, 80, height - 150);

      // éšæœºé€‰æ‹©çƒŸèŠ±ç±»å‹å’Œé¢œè‰²
      let type = random(fireworkTypes);
      let colors = random(colorPalettes);

      fireworks.push(new Firework(startX, startY, targetX, targetY, colors, type));
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // ç§»åŠ¨ç«¯æ§åˆ¶å‡½æ•°
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function toggleControlPanel() {
      const panel = document.getElementById('control-panel');
      const toggle = document.getElementById('mobile-toggle');

      if (!panel || !toggle) {
        console.error('æ§åˆ¶é¢æ¿æˆ–åˆ‡æ¢æŒ‰é’®æœªæ‰¾åˆ°');
        return;
      }

      console.log('åˆ‡æ¢æ§åˆ¶é¢æ¿ï¼Œå½“å‰çŠ¶æ€:', panel.classList.contains('show'));

      panel.classList.toggle('show');
      toggle.classList.toggle('active');

      // æ›´æ–°æŒ‰é’®å›¾æ ‡
      if (panel.classList.contains('show')) {
        toggle.innerHTML = 'âœ•';
        console.log('æ§åˆ¶é¢æ¿å·²æ˜¾ç¤º');
      } else {
        toggle.innerHTML = 'âš™ï¸';
        console.log('æ§åˆ¶é¢æ¿å·²éšè—');
      }
    }

    // æ£€æµ‹è®¾å¤‡ç±»å‹
    function isMobileDevice() {
      return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ||
        window.innerWidth <= 768;
    }

    // ä¼˜åŒ–ç§»åŠ¨ç«¯è§¦æ‘¸ä½“éªŒ
    function optimizeForMobile() {
      if (isMobileDevice()) {
        console.log('æ£€æµ‹åˆ°ç§»åŠ¨è®¾å¤‡ï¼Œåº”ç”¨ç§»åŠ¨ç«¯ä¼˜åŒ–');

        // ç¡®ä¿ç§»åŠ¨ç«¯åˆ‡æ¢æŒ‰é’®å¯è§
        const mobileToggle = document.getElementById('mobile-toggle');
        const touchControls = document.getElementById('touch-controls');

        if (mobileToggle) {
          mobileToggle.style.display = 'flex';
          console.log('ç§»åŠ¨ç«¯åˆ‡æ¢æŒ‰é’®å·²æ˜¾ç¤º');
        }

        if (touchControls) {
          touchControls.style.display = 'flex';
          console.log('è§¦æ‘¸æ§åˆ¶æŒ‰é’®å·²æ˜¾ç¤º');
        }

        // ç¡®ä¿æ§åˆ¶é¢æ¿åœ¨ç§»åŠ¨ç«¯é»˜è®¤éšè—
        const controlPanel = document.getElementById('control-panel');
        if (controlPanel) {
          controlPanel.classList.remove('show');
          console.log('æ§åˆ¶é¢æ¿å·²éšè—');
        }

        // ç¦ç”¨åŒå‡»ç¼©æ”¾
        document.addEventListener('touchstart', function (e) {
          if (e.touches.length > 1) {
            e.preventDefault();
          }
        });

        let lastTouchEnd = 0;
        document.addEventListener('touchend', function (e) {
          const now = (new Date()).getTime();
          if (now - lastTouchEnd <= 300) {
            e.preventDefault();
          }
          lastTouchEnd = now;
        }, false);

        // æ·»åŠ è§¦æ‘¸æ§åˆ¶æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
        const launchBtn = document.getElementById('launch-btn');
        const burstBtn = document.getElementById('burst-btn');
        const blessingBtn = document.getElementById('blessing-btn');
        const clearBtn = document.getElementById('clear-btn');

        if (launchBtn) {
          launchBtn.addEventListener('touchstart', function (e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.transform = 'scale(0.9)';
          });

          launchBtn.addEventListener('touchend', function (e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.transform = '';
            launchFirework();
          });

          launchBtn.addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            launchFirework();
          });
        }

        if (burstBtn) {
          burstBtn.addEventListener('touchstart', function (e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.transform = 'scale(0.9)';
          });

          burstBtn.addEventListener('touchend', function (e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.transform = '';
            launchBurst();
          });

          burstBtn.addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            launchBurst();
          });
        }

        if (blessingBtn) {
          blessingBtn.addEventListener('touchstart', function (e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.transform = 'scale(0.9)';
          });

          blessingBtn.addEventListener('touchend', function (e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.transform = '';
            showRandomBlessing();
          });

          blessingBtn.addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            showRandomBlessing();
          });
        }

        if (clearBtn) {
          clearBtn.addEventListener('touchstart', function (e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.transform = 'scale(0.9)';
          });

          clearBtn.addEventListener('touchend', function (e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.transform = '';
            clearScreen();
          });

          clearBtn.addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            clearScreen();
          });
        }

        // æ·»åŠ è§¦æ‘¸åé¦ˆç»™å…¶ä»–æŒ‰é’®
        const otherButtons = document.querySelectorAll('.control-button, .mobile-toggle');
        otherButtons.forEach(button => {
          button.addEventListener('touchstart', function () {
            this.style.transform = 'scale(0.95)';
          });

          button.addEventListener('touchend', function () {
            setTimeout(() => {
              this.style.transform = '';
            }, 150);
          });
        });

        // ä¼˜åŒ–æ»‘å—è§¦æ‘¸ä½“éªŒ
        const sliders = document.querySelectorAll('.slider');
        sliders.forEach(slider => {
          slider.addEventListener('touchstart', function (e) {
            e.stopPropagation();
          });

          slider.addEventListener('touchmove', function (e) {
            e.stopPropagation();
          });
        });
      } else {
        console.log('æ£€æµ‹åˆ°æ¡Œé¢è®¾å¤‡');
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å¤‡ç”¨è§¦æ‘¸æŒ‰é’®åˆå§‹åŒ–
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function initializeTouchButtons() {
      // ç¡®ä¿åœ¨DOMåŠ è½½å®Œæˆååˆå§‹åŒ–æŒ‰é’®
      setTimeout(() => {
        const launchBtn = document.getElementById('launch-btn');
        const burstBtn = document.getElementById('burst-btn');
        const blessingBtn = document.getElementById('blessing-btn');
        const clearBtn = document.getElementById('clear-btn');

        // å‘å°„çƒŸèŠ±æŒ‰é’®
        if (launchBtn && !launchBtn.hasAttribute('data-initialized')) {
          launchBtn.setAttribute('data-initialized', 'true');

          launchBtn.addEventListener('touchstart', function (e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.transform = 'scale(0.9)';
            this.style.boxShadow = '0 0 20px rgba(255, 71, 87, 0.8)';
          });

          launchBtn.addEventListener('touchend', function (e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.transform = '';
            this.style.boxShadow = '';
            console.log('å‘å°„çƒŸèŠ±æŒ‰é’®è¢«ç‚¹å‡»');
            launchFirework();
          });

          launchBtn.addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('å‘å°„çƒŸèŠ±æŒ‰é’®è¢«ç‚¹å‡» (click)');
            launchFirework();
          });
        }

        // è¿å‘æŒ‰é’®
        if (burstBtn && !burstBtn.hasAttribute('data-initialized')) {
          burstBtn.setAttribute('data-initialized', 'true');

          burstBtn.addEventListener('touchstart', function (e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.transform = 'scale(0.9)';
            this.style.boxShadow = '0 0 20px rgba(0, 245, 255, 0.8)';
          });

          burstBtn.addEventListener('touchend', function (e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.transform = '';
            this.style.boxShadow = '';
            console.log('è¿å‘æŒ‰é’®è¢«ç‚¹å‡»');
            launchBurst();
          });

          burstBtn.addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('è¿å‘æŒ‰é’®è¢«ç‚¹å‡» (click)');
            launchBurst();
          });
        }

        // ç¥ç¦è¯­æŒ‰é’®
        if (blessingBtn && !blessingBtn.hasAttribute('data-initialized')) {
          blessingBtn.setAttribute('data-initialized', 'true');

          blessingBtn.addEventListener('touchstart', function (e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.transform = 'scale(0.9)';
            this.style.boxShadow = '0 0 20px rgba(255, 215, 0, 0.8)';
          });

          blessingBtn.addEventListener('touchend', function (e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.transform = '';
            this.style.boxShadow = '';
            console.log('ç¥ç¦è¯­æŒ‰é’®è¢«ç‚¹å‡»');
            showRandomBlessing();
          });

          blessingBtn.addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('ç¥ç¦è¯­æŒ‰é’®è¢«ç‚¹å‡» (click)');
            showRandomBlessing();
          });
        }

        // æ¸…å±æŒ‰é’®
        if (clearBtn && !clearBtn.hasAttribute('data-initialized')) {
          clearBtn.setAttribute('data-initialized', 'true');

          clearBtn.addEventListener('touchstart', function (e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.transform = 'scale(0.9)';
            this.style.boxShadow = '0 0 20px rgba(0, 245, 255, 0.8)';
          });

          clearBtn.addEventListener('touchend', function (e) {
            e.preventDefault();
            e.stopPropagation();
            this.style.transform = '';
            this.style.boxShadow = '';
            console.log('æ¸…å±æŒ‰é’®è¢«ç‚¹å‡»');
            clearScreen();
          });

          clearBtn.addEventListener('click', function (e) {
            e.preventDefault();
            e.stopPropagation();
            console.log('æ¸…å±æŒ‰é’®è¢«ç‚¹å‡» (click)');
            clearScreen();
          });
        }
      }, 1000); // å»¶è¿Ÿ1ç§’ç¡®ä¿DOMå®Œå…¨åŠ è½½
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // å¢å¼ºçš„è§¦æ‘¸äº¤äº’
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    let touchStartTime = 0;
    let touchStartPos = { x: 0, y: 0 };

    function touchStarted() {
      touchStartTime = millis();
      touchStartPos.x = mouseX;
      touchStartPos.y = mouseY;

      // é˜²æ­¢é»˜è®¤çš„è§¦æ‘¸è¡Œä¸º
      return false;
    }

    function touchEnded() {
      const touchDuration = millis() - touchStartTime;
      const touchDistance = dist(mouseX, mouseY, touchStartPos.x, touchStartPos.y);

      // å¦‚æœæ˜¯çŸ­æ—¶é—´çš„è½»è§¦ä¸”æ²¡æœ‰ç§»åŠ¨å¤ªè¿œï¼Œåˆ™å‘å°„çƒŸèŠ±
      if (touchDuration < 500 && touchDistance < 20) {
        // æ£€æŸ¥è§¦æ‘¸ä½ç½®æ˜¯å¦åœ¨ç”»å¸ƒåŒºåŸŸ
        if (mouseX > 0 && mouseX < width && mouseY > 0 && mouseY < height) {
          // é¿å…åœ¨æ§åˆ¶é¢æ¿åŒºåŸŸå‘å°„çƒŸèŠ±
          const panel = document.getElementById('control-panel');
          const panelRect = panel.getBoundingClientRect();
          const canvasRect = document.getElementById('fireworks-canvas').getBoundingClientRect();

          const relativeX = mouseX + canvasRect.left;
          const relativeY = mouseY + canvasRect.top;

          if (!(relativeX >= panelRect.left && relativeX <= panelRect.right &&
            relativeY >= panelRect.top && relativeY <= panelRect.bottom)) {
            launchFireworkToPosition(mouseX, mouseY);
          }
        }
      }

      return false;
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UI æ§åˆ¶å¤„ç†
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function initializeControls() {
      // ä¸ºæ‰€æœ‰æ»‘å—æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
      const sliders = ['launchRate', 'explosionPower', 'particleCount', 'gravity', 'trailLength', 'sparkleIntensity', 'blessingChance'];

      sliders.forEach(sliderId => {
        const slider = document.getElementById(sliderId);
        const valueDisplay = document.getElementById(sliderId + '-value');

        slider.addEventListener('input', function () {
          params[sliderId] = parseFloat(this.value);
          valueDisplay.textContent = this.value;
        });

        // åˆå§‹åŒ–æ˜¾ç¤ºå€¼
        valueDisplay.textContent = slider.value;
        params[sliderId] = parseFloat(slider.value);
      });
    }

    function updateStats() {
      frameCounter++;

      if (millis() - lastFPSUpdate > 1000) {
        document.getElementById('fps').textContent = frameCounter;
        frameCounter = 0;
        lastFPSUpdate = millis();
      }

      document.getElementById('firework-count').textContent = fireworks.length;

      let totalParticles = 0;
      fireworks.forEach(fw => {
        totalParticles += fw.particles.length;
      });
      document.getElementById('particle-count').textContent = totalParticles + ' + ' + blessings.length + 'ç¥ç¦';
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // åŠ è½½åŠ¨ç”»
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function simulateLoading() {
      let progress = 0;
      const loadingInterval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress >= 100) {
          progress = 100;
          clearInterval(loadingInterval);

          setTimeout(() => {
            document.getElementById('loading-screen').style.opacity = '0';
            setTimeout(() => {
              document.getElementById('loading-screen').style.display = 'none';
            }, 500);
          }, 500);
        }

        document.getElementById('loading-progress').style.width = progress + '%';
      }, 100);
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // é”®ç›˜å’Œé¼ æ ‡äº¤äº’ï¼ˆæ¡Œé¢ç«¯ï¼‰
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    function keyPressed() {
      if (key === ' ') {
        launchFirework();
      } else if (key === 'b' || key === 'B') {
        launchBurst();
      } else if (key === 'c' || key === 'C') {
        clearScreen();
      }
    }

    // é¼ æ ‡ç‚¹å‡»å‘å°„çƒŸèŠ±ï¼ˆæ¡Œé¢ç«¯ï¼‰
    function mousePressed() {
      if (!isMobileDevice() && mouseX > 0 && mouseX < width && mouseY > 0 && mouseY < height) {
        let startX = random(width * 0.2, width * 0.8);
        let startY = height;

        // ç¡®ä¿é¼ æ ‡ç‚¹å‡»çš„ç›®æ ‡ç‚¹åœ¨å®‰å…¨èŒƒå›´å†…
        let targetX = constrain(mouseX, 100, width - 100);
        let targetY = constrain(mouseY, 80, height - 150);

        // éšæœºé€‰æ‹©çƒŸèŠ±ç±»å‹å’Œé¢œè‰²
        let type = random(fireworkTypes);
        let colors = random(colorPalettes);

        fireworks.push(new Firework(startX, startY, targetX, targetY, colors, type));
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    // ç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½ååˆå§‹åŒ–æŒ‰é’®
    window.addEventListener('load', function () {
      initializeTouchButtons();
    });

    // DOMå†…å®¹åŠ è½½å®Œæˆåä¹Ÿå°è¯•åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function () {
      initializeTouchButtons();
    });
  </script>
</body>

</html>